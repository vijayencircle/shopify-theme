{% assign s = section.settings %}

<style>
  /* ===============================
     MOBILE BOTTOM NAV
     =============================== */

  #mobile-bottom-nav-{{ section.id }} {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    z-index: 999;
    background: {{ s.bg_color }};
    border-radius: 20px 20px 0 0;
    box-shadow: 0 -6px 20px rgba(0, 0, 0, 0.15);
  }

  .mbn-inner {
    display: flex;
    align-items: center;
    justify-content: space-around;
    padding: 14px 10px;
  }

  .mbn-item {
    flex: 1;
    text-align: center;
    text-decoration: none;
    color: {{ s.inactive_color }};
    font-size: {{ s.text_size }}px;
    font-weight: 500;
    transition: color 0.25s ease;
    position: relative;
  }

  .mbn-item svg {
    display: block;
    margin: 0 auto 4px;
    width: 22px;
    height: 22px;
    fill: currentColor;
  }

  /* ACTIVE STATE */
  .mbn-item.is-active {
    color: {{ s.active_color }};
  }

  .mbn-item.is-active::after {
    content: "";
    position: absolute;
    bottom: -6px;
    left: 50%;
    transform: translateX(-50%);
    width: 18px;
    height: 4px;
    background: {{ s.active_color }};
    border-radius: 2px;
  }

  /* MOBILE ONLY */
  @media (min-width: 769px) {
    #mobile-bottom-nav-{{ section.id }} {
      display: none;
    }
  }

  /* SAFE SPACE FOR FIXED NAV */
  @media (max-width: 768px) {
    body {
      padding-bottom: 80px;
    }
  }
</style>

<div id="mobile-bottom-nav-{{ section.id }}">
  <div class="mbn-inner">
    {% for block in section.blocks %}
      {% if block.settings.enable %}
        <a
          href="{{ block.settings.link }}"
          class="mbn-item {% if forloop.first %}is-active{% endif %}"
          data-mbn-item
        >
          {{ block.settings.icon }}
          <span>{{ block.settings.label }}</span>
        </a>
      {% endif %}
    {% endfor %}
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const nav = document.querySelector("#mobile-bottom-nav-{{ section.id }}");
    if (!nav) return;

    const items = nav.querySelectorAll("[data-mbn-item]");
    const currentPath = window.location.pathname.replace(/\/$/, '');

    items.forEach(item => {
      const itemPath = item.getAttribute("href").replace(/\/$/, '');

      if (itemPath === currentPath) {
        items.forEach(i => i.classList.remove("is-active"));
        item.classList.add("is-active");
      }
    });
  });
</script>


{% schema %}
{
  "name": "Mobile Bottom Navigation",

  "enabled_on": {
    "templates": ["*"]
  },

  "settings": [
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "inactive_color",
      "label": "Inactive text & icon color",
      "default": "#c6c6c6"
    },
    {
      "type": "color",
      "id": "active_color",
      "label": "Active text & icon color",
      "default": "#ff3b30"
    },
    {
      "type": "range",
      "id": "text_size",
      "label": "Text size",
      "min": 10,
      "max": 16,
      "step": 1,
      "default": 12
    }
  ],

  "blocks": [
    {
      "type": "item",
      "name": "Nav Item",
      "settings": [
        {
          "type": "checkbox",
          "id": "enable",
          "label": "Enable item",
          "default": true
        },
        {
          "type": "html",
          "id": "icon",
          "label": "SVG Icon",
          "default": "<svg viewBox='0 0 24 24'><path d='M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z'/></svg>"
        },
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Home"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link",
          "default": "/"
        }
      ]
    }
  ],

  "max_blocks": 5,

  "presets": [
    {
      "name": "Mobile Bottom Navigation"
    }
  ]
}
{% endschema %}
